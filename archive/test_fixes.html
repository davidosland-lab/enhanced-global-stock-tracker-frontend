<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fixed Components</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #1a1a2e; color: #eee; }
        .test-card { background: #16213e; border: 1px solid #0f3460; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Testing Fixed Components</h1>
        
        <!-- Test 1: Single Stock Tracker -->
        <div class="test-card rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">1. Single Stock Tracker - Start Tracking</h2>
            <div class="flex gap-4 items-center">
                <input type="text" id="stockSymbol" value="CBA.AX" placeholder="Enter symbol" 
                       class="px-4 py-2 bg-gray-800 rounded">
                <button onclick="testStockTracking()" 
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded">
                    Test Start Tracking
                </button>
                <div id="stockResult" class="flex-1"></div>
            </div>
        </div>
        
        <!-- Test 2: Unified Prediction -->
        <div class="test-card rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">2. Unified Prediction Center</h2>
            <div class="flex gap-4 items-center">
                <input type="text" id="predSymbol" value="BHP.AX" placeholder="Enter symbol" 
                       class="px-4 py-2 bg-gray-800 rounded">
                <select id="timeframe" class="px-4 py-2 bg-gray-800 rounded">
                    <option value="5d">5 Days</option>
                    <option value="30d">30 Days</option>
                </select>
                <button onclick="testUnifiedPrediction()" 
                        class="px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded">
                    Test Prediction
                </button>
                <div id="predResult" class="flex-1"></div>
            </div>
        </div>
        
        <!-- Test 3: Performance Dashboard -->
        <div class="test-card rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">3. Performance Dashboard</h2>
            <div class="flex gap-4 items-center">
                <button onclick="testDashboard()" 
                        class="px-6 py-2 bg-green-600 hover:bg-green-700 rounded">
                    Test Dashboard API
                </button>
                <div id="dashResult" class="flex-1"></div>
            </div>
        </div>
        
        <!-- Results Display -->
        <div class="test-card rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">API Response Details</h2>
            <pre id="apiDetails" class="text-xs overflow-auto max-h-96 bg-gray-900 p-4 rounded"></pre>
        </div>
    </div>
    
    <script>
        // Determine API base URL
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8000'
            : 'https://enhanced-global-stock-tracker-frontend.onrender.com';
        
        function showResult(elementId, success, message, details = null) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <span class="${success ? 'text-green-400' : 'text-red-400'}">
                    ${success ? '‚úÖ' : '‚ùå'} ${message}
                </span>
            `;
            if (details) {
                document.getElementById('apiDetails').textContent = JSON.stringify(details, null, 2);
            }
        }
        
        async function testStockTracking() {
            const symbol = document.getElementById('stockSymbol').value;
            showResult('stockResult', false, 'Testing...', null);
            
            try {
                const response = await fetch(`${API_BASE}/api/stock/${symbol}?period=1d&interval=1m`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('stockResult', true, 
                        `Success! Got ${data.data?.length || 0} data points`, data);
                } else {
                    showResult('stockResult', false, 
                        `Failed: ${data.error || 'Unknown error'}`, data);
                }
            } catch (error) {
                showResult('stockResult', false, `Error: ${error.message}`, error);
            }
        }
        
        async function testUnifiedPrediction() {
            const symbol = document.getElementById('predSymbol').value;
            const timeframe = document.getElementById('timeframe').value;
            showResult('predResult', false, 'Generating prediction...', null);
            
            try {
                const response = await fetch(`${API_BASE}/api/unified-prediction/${symbol}?timeframe=${timeframe}`);
                const data = await response.json();
                
                if (response.ok && data.prediction) {
                    const pred = data.prediction;
                    showResult('predResult', true, 
                        `${pred.direction} ${(pred.expected_return * 100).toFixed(2)}% (${(pred.confidence_score * 100).toFixed(1)}% confidence)`, 
                        data);
                } else {
                    showResult('predResult', false, 
                        `Failed: ${data.error || 'No prediction generated'}`, data);
                }
            } catch (error) {
                showResult('predResult', false, `Error: ${error.message}`, error);
            }
        }
        
        async function testDashboard() {
            showResult('dashResult', false, 'Loading dashboard data...', null);
            
            try {
                const response = await fetch(`${API_BASE}/api/dashboard/comprehensive-data?timeframe=24h`);
                const data = await response.json();
                
                if (response.ok && data.metrics) {
                    showResult('dashResult', true, 
                        `Phase 4: ${(data.metrics.phase4_accuracy * 100).toFixed(1)}% accuracy | ${data.metrics.total_predictions} predictions`, 
                        data);
                } else {
                    showResult('dashResult', false, 
                        `Failed: ${data.error || 'No data'}`, data);
                }
            } catch (error) {
                showResult('dashResult', false, `Error: ${error.message}`, error);
            }
        }
        
        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('üîß Using API base:', API_BASE);
            document.getElementById('apiDetails').textContent = `API Base URL: ${API_BASE}\n\nClick any test button to see API responses here.`;
        });
    </script>
</body>
</html>