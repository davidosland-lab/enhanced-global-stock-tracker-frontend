<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test All Modules - API Connectivity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-['Inter'] bg-gray-100">
    <div class="max-w-6xl mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Module API Test Dashboard</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Single Stock Tracker Test -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üìà Single Stock Tracker</h2>
                <div id="stock-test" class="space-y-2">
                    <button onclick="testStockAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        Test Stock API
                    </button>
                    <div id="stock-result" class="mt-2 p-2 bg-gray-100 rounded text-sm"></div>
                </div>
            </div>

            <!-- Technical Analysis Test -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üìä Technical Analysis</h2>
                <div id="technical-test" class="space-y-2">
                    <button onclick="testTechnicalAPI()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        Test Technical API
                    </button>
                    <div id="technical-result" class="mt-2 p-2 bg-gray-100 rounded text-sm"></div>
                </div>
            </div>

            <!-- Unified Prediction Test -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üîÆ Unified Prediction</h2>
                <div id="prediction-test" class="space-y-2">
                    <button onclick="testPredictionAPI()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        Test Prediction API
                    </button>
                    <div id="prediction-result" class="mt-2 p-2 bg-gray-100 rounded text-sm"></div>
                </div>
            </div>

            <!-- Performance Dashboard Test -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üìâ Performance Dashboard</h2>
                <div id="dashboard-test" class="space-y-2">
                    <button onclick="testDashboardAPI()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                        Test Dashboard API
                    </button>
                    <div id="dashboard-result" class="mt-2 p-2 bg-gray-100 rounded text-sm"></div>
                </div>
            </div>
        </div>

        <!-- API Status Summary -->
        <div class="mt-8 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">üåê API Configuration</h2>
            <div id="api-config" class="text-sm font-mono bg-gray-100 p-4 rounded"></div>
        </div>
    </div>

    <script>
        // Determine API base URL
        let API_BASE_URL;
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            API_BASE_URL = 'http://localhost:8000';
        } else if (window.location.hostname.includes('netlify') || window.location.hostname.includes('netlifyapp')) {
            API_BASE_URL = 'https://enhanced-global-stock-tracker-backend.onrender.com';
        } else {
            API_BASE_URL = window.location.origin;
        }

        // Display configuration
        document.getElementById('api-config').innerHTML = `
            <div>Environment: ${window.location.hostname}</div>
            <div>API Base URL: ${API_BASE_URL}</div>
            <div>Timestamp: ${new Date().toISOString()}</div>
        `;

        // Test Single Stock API
        async function testStockAPI() {
            const resultDiv = document.getElementById('stock-result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/stock/AAPL?period=1d&interval=5m`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="text-green-600 font-semibold">‚úÖ Success!</div>
                        <div>Symbol: ${data.symbol}</div>
                        <div>Data Points: ${data.data?.length || 0}</div>
                        <div>Latest Price: $${data.data?.[data.data.length-1]?.close?.toFixed(2) || 'N/A'}</div>
                    `;
                } else {
                    throw new Error(data.detail || 'API Error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Test Technical Analysis API
        async function testTechnicalAPI() {
            const resultDiv = document.getElementById('technical-result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/technical/analysis/AAPL?period=1mo&interval=1d`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const analysis = data.data;
                    resultDiv.innerHTML = `
                        <div class="text-green-600 font-semibold">‚úÖ Success!</div>
                        <div>Current Price: $${analysis.current_price?.toFixed(2)}</div>
                        <div>Signal: ${analysis.overall_signal}</div>
                        <div>RSI: ${analysis.indicators?.rsi?.value?.toFixed(2)}</div>
                        <div>Confidence: ${(analysis.confidence * 100).toFixed(1)}%</div>
                    `;
                } else {
                    throw new Error(data.detail || 'API Error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Test Unified Prediction API
        async function testPredictionAPI() {
            const resultDiv = document.getElementById('prediction-result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/unified-prediction/AAPL?timeframe=5d`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = `
                        <div class="text-green-600 font-semibold">‚úÖ Success!</div>
                        <div>Direction: ${data.prediction?.direction}</div>
                        <div>Expected Return: ${(data.prediction?.expected_return * 100)?.toFixed(2)}%</div>
                        <div>Confidence: ${(data.prediction?.confidence * 100)?.toFixed(1)}%</div>
                        <div>Type: ${data.prediction_type}</div>
                    `;
                } else {
                    throw new Error(data.detail || 'API Error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Test Dashboard API
        async function testDashboardAPI() {
            const resultDiv = document.getElementById('dashboard-result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/dashboard/comprehensive-data?timeframe=24h`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="text-green-600 font-semibold">‚úÖ Success!</div>
                        <div>Total Predictions: ${data.summary?.total_predictions}</div>
                        <div>Overall Accuracy: ${(data.summary?.overall_accuracy * 100)?.toFixed(1)}%</div>
                        <div>Active Models: ${data.summary?.active_models}</div>
                        <div>Best Model: ${data.summary?.best_model}</div>
                    `;
                } else {
                    throw new Error(data.detail || 'API Error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Auto-test all on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('Running automated tests...');
                testStockAPI();
                testTechnicalAPI();
                testPredictionAPI();
                testDashboardAPI();
            }, 1000);
        });
    </script>
</body>
</html>