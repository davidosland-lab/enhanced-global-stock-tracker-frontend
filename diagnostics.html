<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Diagnostics - API Status</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-['Inter'] bg-gray-900 text-white">
    <div class="max-w-6xl mx-auto p-6">
        <h1 class="text-4xl font-bold mb-8 text-center">üîç System Diagnostics</h1>
        
        <div class="bg-red-900 border border-red-500 rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4 text-red-300">‚ö†Ô∏è Critical Issue Detected</h2>
            <p class="text-lg mb-4">The backend API server is <strong>NOT DEPLOYED</strong>.</p>
            <p class="mb-4">This is why the modules are not working. The frontend is trying to connect to a backend that doesn't exist.</p>
            <div class="bg-black/50 p-4 rounded">
                <p class="font-mono text-sm">Expected Backend URL: https://enhanced-global-stock-tracker-backend.onrender.com</p>
                <p class="font-mono text-sm">Status: <span class="text-red-400">NOT FOUND (Service does not exist)</span></p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-semibold mb-4">üìç Current Environment</h3>
                <div class="space-y-2 font-mono text-sm">
                    <div>Hostname: <span id="hostname" class="text-blue-400"></span></div>
                    <div>Protocol: <span id="protocol" class="text-blue-400"></span></div>
                    <div>Port: <span id="port" class="text-blue-400"></span></div>
                    <div>Origin: <span id="origin" class="text-blue-400"></span></div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-semibold mb-4">üîß Configuration</h3>
                <div class="space-y-2 font-mono text-sm">
                    <div>Config Loaded: <span id="config-loaded" class="text-yellow-400"></span></div>
                    <div>API Base URL: <span id="api-base" class="text-yellow-400"></span></div>
                    <div>Backend Status: <span id="backend-status" class="text-red-400">Not Deployed</span></div>
                </div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4">üß™ API Endpoint Tests</h3>
            <div id="test-results" class="space-y-3"></div>
            <button onclick="runTests()" class="mt-4 bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded">
                Run All Tests
            </button>
        </div>

        <div class="bg-yellow-900 border border-yellow-500 rounded-lg p-6">
            <h2 class="text-2xl font-bold mb-4 text-yellow-300">üöÄ Solution Required</h2>
            <ol class="list-decimal list-inside space-y-2">
                <li>Create a new GitHub repository for the backend: <code>enhanced-global-stock-tracker-backend</code></li>
                <li>Copy all files from <code>/render_backend/</code> to the new repository</li>
                <li>Deploy on Render.com as a Python web service</li>
                <li>Update <code>config.js</code> and <code>api_config.js</code> with the deployed backend URL</li>
                <li>Alternatively, use one of these services:
                    <ul class="list-disc list-inside ml-6 mt-2">
                        <li>Railway.app</li>
                        <li>Deta.sh</li>
                        <li>PythonAnywhere</li>
                        <li>Replit</li>
                    </ul>
                </li>
            </ol>
            
            <div class="mt-6 p-4 bg-black/50 rounded">
                <p class="text-sm mb-2">Quick test with local backend:</p>
                <code class="text-xs">
                    cd render_backend && pip install -r requirements.txt && uvicorn main:app --host 0.0.0.0 --port 8000
                </code>
            </div>
        </div>
    </div>

    <script>
        // Display environment info
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('port').textContent = window.location.port || '(default)';
        document.getElementById('origin').textContent = window.location.origin;

        // Check configuration
        const configLoaded = typeof window.API_CONFIG !== 'undefined' || typeof window.CONFIG !== 'undefined';
        document.getElementById('config-loaded').textContent = configLoaded ? 'Yes' : 'No';
        
        let apiBase = 'Not configured';
        if (window.API_CONFIG?.BASE_URL) {
            apiBase = window.API_CONFIG.BASE_URL;
        } else if (window.CONFIG?.BACKEND_URL) {
            apiBase = window.CONFIG.BACKEND_URL;
        } else if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            apiBase = 'http://localhost:8000';
        } else {
            apiBase = 'https://enhanced-global-stock-tracker-backend.onrender.com';
        }
        document.getElementById('api-base').textContent = apiBase;

        // Test endpoints
        async function runTests() {
            const endpoints = [
                { name: 'Health Check', path: '/api/health' },
                { name: 'Stock Data', path: '/api/stock/AAPL' },
                { name: 'Technical Analysis', path: '/api/technical/analysis/AAPL' },
                { name: 'Unified Prediction', path: '/api/unified-prediction/AAPL' },
                { name: 'Dashboard', path: '/api/dashboard/comprehensive-data' },
            ];

            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<div class="text-yellow-400">Running tests...</div>';
            
            const results = [];
            
            for (const endpoint of endpoints) {
                const url = apiBase + endpoint.path;
                const startTime = Date.now();
                
                try {
                    const response = await fetch(url, { 
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache',
                        signal: AbortSignal.timeout(5000)
                    });
                    
                    const elapsed = Date.now() - startTime;
                    
                    if (response.ok) {
                        results.push(`
                            <div class="flex justify-between items-center p-3 bg-green-900/50 rounded">
                                <span>‚úÖ ${endpoint.name}</span>
                                <span class="text-sm text-gray-400">${elapsed}ms</span>
                            </div>
                        `);
                    } else {
                        results.push(`
                            <div class="flex justify-between items-center p-3 bg-yellow-900/50 rounded">
                                <span>‚ö†Ô∏è ${endpoint.name}</span>
                                <span class="text-sm text-gray-400">Status: ${response.status}</span>
                            </div>
                        `);
                    }
                } catch (error) {
                    results.push(`
                        <div class="p-3 bg-red-900/50 rounded">
                            <div>‚ùå ${endpoint.name}</div>
                            <div class="text-sm text-gray-400 mt-1">${error.message}</div>
                        </div>
                    `);
                }
            }
            
            resultsDiv.innerHTML = results.join('');
        }

        // Auto-run tests on load
        setTimeout(runTests, 1000);
    </script>

    <script src="api_config.js"></script>
    <script src="config.js"></script>
</body>
</html>